{% extends "base.html" %}

{% block title %}Settings - Admin Panel{% endblock %}

{% block content %}
<div class="header">
    <h1>Bot Settings</h1>
</div>

<div class="message-builder">
    <form id="settingsForm">
        <h2 class="mb-2">Promo Code and Link</h2>
        
        <div class="form-group">
            <label class="form-label">Promo Code (PROMO_CODE)</label>
            <input type="text" class="form-input" id="promoCode" placeholder="YOUR_PROMO_CODE">
        </div>
        
        <div class="form-group">
            <label class="form-label">Activation Link (ACTIVATION_LINK)</label>
            <input type="url" class="form-input" id="activationLink" 
                   placeholder="https://example.com/activate">
        </div>
        
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadSettings() {
    try {
        const settings = await API.get('/api/settings');
        
        if (settings.PROMO_CODE) {
            document.getElementById('promoCode').value = settings.PROMO_CODE;
        }
        if (settings.ACTIVATION_LINK) {
            document.getElementById('activationLink').value = settings.ACTIVATION_LINK;
        }
    } catch (error) {
        console.error('Error loading settings:', error);
    }
}

document.getElementById('settingsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const promoCode = document.getElementById('promoCode').value;
    const activationLink = document.getElementById('activationLink').value;
    
    try {
        await API.put('/api/settings', {key: 'PROMO_CODE', value: promoCode});
        await API.put('/api/settings', {key: 'ACTIVATION_LINK', value: activationLink});
        
        alert('Settings saved!');
    } catch (error) {
        console.error('Error saving settings:', error);
        alert('Error saving settings');
    }
});

document.addEventListener('DOMContentLoaded', loadSettings);
</script>
{% endblock %}

